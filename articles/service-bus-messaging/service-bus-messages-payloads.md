---
title: Azure Service Bus-meddelanden, nyttolaster och serialisering | Microsoft-dokument
description: Den här artikeln innehåller en översikt över Azure Service Bus-meddelanden, nyttolaster, meddelanderoutning och serialisering.
services: service-bus-messaging
documentationcenter: ''
author: axisc
manager: timlt
editor: spelluru
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/24/2020
ms.author: aschhab
ms.openlocfilehash: 11e56ae2483a254fb00e3593da7841f3f3d844f3
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 03/27/2020
ms.locfileid: "76759405"
---
# <a name="messages-payloads-and-serialization"></a>Meddelanden, nyttolaster och serialisering

Microsoft Azure Service Bus hanterar meddelanden. Meddelanden bär en nyttolast samt metadata, i form av nyckelvärdesparegenskaper, som beskriver nyttolasten och ger hanteringsinstruktioner till Service Bus och applikationer. Ibland är att metadata ensam tillräckligt för att bära den information som avsändaren vill kommunicera med mottagare, och nyttolasten förblir tom.

Objektmodellen för de officiella Service Bus-klienterna för .NET och Java återspeglar den abstrakta meddelandestrukturen För Service Bus, som mappas till och från de kabelprotokoll som Service Bus stöder.
 
Ett Service Bus-meddelande består av ett binärt nyttolastavsnitt som Service Bus aldrig hanterar i någon form på servicesidan och två uppsättningar egenskaper. Mäklarens *egenskaper* är fördefinierade av systemet. Dessa fördefinierade egenskaper styr antingen funktionen på meddelandenivå i mäklaren eller så mappas de till vanliga och standardiserade metadataobjekt. *Användaregenskaperna* är en samling nyckel-värde-par som kan definieras och ställas in av programmet.
 
De fördefinierade mäklaregenskaperna visas i följande tabell. Namnen används med alla officiella klient-API:er och även i [BrokerProperties](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) JSON-objektet för HTTP-protokollmappningen.
 
Motsvarande namn som används på AMQP-protokollnivå visas inom parentes. 

| Egenskapsnamn                         | Beskrivning                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) (innehållstyp)           | Du kan också beskriva meddelandets nyttolast, med en deskriptor enligt formatet RFC2045, avsnitt 5. till exempel `application/json`.                                                                                                                                                                                                                                                                                             |
|  [CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid#Microsoft_Azure_ServiceBus_Message_CorrelationId) (korrelation-id)       | Gör det möjligt för ett program att ange en kontext för meddelandet i samband med korrelation. återspeglar till exempel **MessageId** för ett meddelande som besvaras.                                                                                                                                                                                                                                                                  |
| [DeadLetterKälla](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deadlettersource)                      | Ange endast i meddelanden som har bokboksförts och därefter automatiskt vidarebefordrats från kön för obeställbara meddelanden till en annan entitet. Anger i vilken entitet meddelandet har skickats obedömare. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                                                  |
| [LeveransPlats](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount)                         | Antal leveranser som har gjorts för det här meddelandet. Antalet ökas när ett meddelandelås upphör att gälla eller meddelandet uttryckligen överges av mottagaren. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                                                                  |
| [EnqueuedSequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedsequencenumber)                | För meddelanden som har vidarebefordrats automatiskt återspeglar den här egenskapen det sekvensnummer som först hade tilldelats meddelandet vid dess ursprungliga inlämningspunkt. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                                                                                |
| [EnqueuedTimeUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedtimeutc)                       | UTC-ögonblick då meddelandet har accepterats och lagrats i entiteten. Det här värdet kan användas som en auktoritär och neutral ankomsttidsindikator när mottagaren inte vill lita på avsändarens klocka. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                   |
|  [ExpiresAtUtc](/dotnet/api/microsoft.azure.servicebus.message.expiresatutc) (absolut utgångstid) | UTC-ögonblick då meddelandet är markerat för borttagning och inte längre tillgängligt för hämtning från entiteten på grund av dess förfallodatum. Förfallodatum styrs av egenskapen **TimeToLive** och den här egenskapen beräknas från EnqueuedTimeUtc+TimeToLive. Den här egenskapen är skrivskyddad.                                                                                                                                                                           |
| [ForcePersistence (50)](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence)                      | För köer eller ämnen som har [flaggan EnableExpress](/dotnet/api/microsoft.servicebus.messaging.queuedescription.enableexpress) inställd kan den här egenskapen ställas in för att ange att meddelandet måste sparas på disken innan det bekräftas. Detta är standardbeteendet för alla icke-expressentiteter.                                                                                                                                                                                                         |
| [Etikett](/dotnet/api/microsoft.azure.servicebus.message.label) (ämne)                       | Den här egenskapen gör det möjligt för programmet att ange syftet med meddelandet till mottagaren på ett standardiserat sätt, liknande en ämnesrad för e-post.                                                                                                                                                                                                                                                                                  |
| [LockedUntilUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.lockeduntilutc)                        | För meddelanden som hämtas under ett lås (peek-lock mottagningsläge, inte förutbäst) återspeglar den här egenskapen UTC-direktståelsen tills meddelandet hålls låst i kön/prenumerationen. När låset upphör att gälla ökas [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount) och meddelandet är åter tillgängligt för hämtning. Den här egenskapen är skrivskyddad.                                                                                                                         |
| [LockToken (svenska)](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.locktoken)                             | Låstoken är en referens till låset som hålls av mäklaren i *peek-lock* mottagningsläge. Token kan användas för att fästa låset permanent via [Deferral](message-deferral.md) API och därmed ta meddelandet ur det vanliga leveranstillståndsflödet. Den här egenskapen är skrivskyddad.                                                                                                                                                               |
| [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid) (meddelande-id)                | Meddelandeidentifieraren är ett programdefinierat värde som unikt identifierar meddelandet och dess nyttolast. Identifieraren är en frihandssträng och kan återspegla ett GUID eller en identifierare som härleds från programkontexten. Om den aktiveras identifierar och tar [du](duplicate-detection.md) bort andra och ytterligare inlämningar av meddelanden med samma **MessageId**.                                                                |
| [PartitionKey](/dotnet/api/microsoft.azure.servicebus.message.partitionkey)                          | För [partitionerade entiteter](service-bus-partitioning.md)gör inställningen av det här värdet det här värdet att relaterade meddelanden tilldelas samma interna partition, så att inlämningssekvensordningen registreras korrekt. Partitionen väljs av en hash-funktion över det här värdet och kan inte väljas direkt. För sessionsmedvetna entiteter åsidosätter **egenskapen SessionId** det här värdet.                                                                                                       |
| [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto) (svara på)                    | Det här valfria och programdefinierade värdet är ett standardsätt för att uttrycka en svarssökväg till mottagaren av meddelandet. När en avsändare förväntar sig ett svar anger den värdet till den absoluta eller relativa sökvägen för den kö eller det ämne som den förväntar sig att svaret ska skickas till.                                                                                                                                           |
| [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid) (svar-till-grupp-id)  | Det här värdet förstärker **ReplyTo-informationen** och anger vilken **SessionId** som ska anges för svaret när det skickas till svarsentiteten.                                                                                                                                                                                                                                                                            |
| [SchemalagdaEnqueueTimeUtc](/dotnet/api/microsoft.azure.servicebus.message.scheduledenqueuetimeutc)               | För meddelanden som endast görs tillgängliga för hämtning efter en fördröjning definierar den här egenskapen det UTC-ögonblick då meddelandet ska tillämpas logiskt, sekvenseras och därför göras tillgängligt för hämtning.                                                                                                                                                                                                                 |
| [Sekvensnummer](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.sequencenumber)                        | Sekvensnumret är ett unikt 64-bitars heltal som tilldelats ett meddelande när det accepteras och lagras av mäklaren och fungerar som dess sanna identifierare. För partitionerade entiteter återspeglar de översta 16 bitarna partitionsidentifieraren. Sekvensnummer monotoniskt öka och är gapless. De rullar över till 0 när 48-64-bitarsområdet är uttömt. Den här egenskapen är skrivskyddad.                                                                |
| [SessionId](/dotnet/api/microsoft.azure.servicebus.message.sessionid) (grupp-ID)                  | För sessionsmedvetna entiteter anger det här programdefinierade värdet meddelandets sessionstillhörighet. Meddelanden med samma sessionsidentifierare är föremål för sammanfattningslåsning och möjliggör exakt ordningsbearbetning och demultiplexing. För entiteter som inte är sessionsmedvetna ignoreras det här värdet.                                                                                                                                     |
| [Storlek](/dotnet/api/microsoft.azure.servicebus.message.size)                                  | Återspeglar den lagrade storleken på meddelandet i mäklarloggen som ett antal byte, eftersom det räknas in i lagringskvoten. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                                                                                                                       |
| [Status](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.state)                                 | Anger tillståndet för meddelandet i loggen. Den här egenskapen är endast relevant under meddelandebläddring ("peek"), för att avgöra om ett meddelande är "aktivt" och tillgängligt för hämtning när det når toppen av kön, om det skjuts upp eller väntar på att schemaläggas. Den här egenskapen är skrivskyddad.                                                                                                                                           |
| [TimeToLive](/dotnet/api/microsoft.azure.servicebus.message.timetolive)                            | Det här värdet är den relativa varaktighet efter vilken meddelandet upphör att gälla, med början från det ögonblick som meddelandet har accepterats och lagrats av mäklaren, som fångas i **EnqueueTimeUtc**. När det inte uttryckligen anges är det antagna värdet **DefaultTimeToLive** för respektive kö eller ämne. Ett **TimeToLive-värde** på meddelandenivå kan inte vara längre än entitetens **DefaultTimeToLive-inställning.** Om den är längre justeras den tyst. |
| [Till](/dotnet/api/microsoft.azure.servicebus.message.to) (till)                               | Den här egenskapen är reserverad för framtida användning i routningsscenarier och ignoreras för närvarande av mäklaren själv. Program kan använda det här värdet i regeldrivna kedjeringsscenarier för automatisk vidarebefordran för att ange meddelandets avsedda logiska mål.                                                                                                                                                                                   |
| [ViaPartitionKey](/dotnet/api/microsoft.azure.servicebus.message.viapartitionkey)                       | Om ett meddelande skickas via en överföringskö i en transaktions omfattning väljer det här värdet överföringskönpartitionen.                                                                                                                                                                                                                                                                                                                 |

Den abstrakta meddelandemodellen gör att ett meddelande kan publiceras i en kö via HTTP (faktiskt alltid HTTPS) och kan hämtas via AMQP. I båda fallen ser meddelandet normalt ut i samband med respektive protokoll. Mäklaregenskaperna översätts efter behov och användaregenskaperna mappas till den lämpligaste platsen på respektive protokollmeddelandemodell. I HTTP mappar användaregenskaperna direkt till och från HTTP-huvuden. i AMQP mappas de till och från **program-egenskapskartan.**

## <a name="message-routing-and-correlation"></a>Meddelanderoutning och korrelation

En delmängd av de mäklareegenskaper som beskrivits tidigare, särskilt [Till](/dotnet/api/microsoft.azure.servicebus.message.to), [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto), [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid), [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid), [CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid)och [SessionId](/dotnet/api/microsoft.azure.servicebus.message.sessionid), används för att hjälpa program att dirigera meddelanden till vissa destinationer. För att illustrera detta, överväga några mönster:

- **Enkel begäran/svar**: En utgivare skickar ett meddelande till en kö och förväntar sig ett svar från meddelandekonsumenten. För att få svaret äger utgivaren en kö där den förväntar sig att svar ska levereras. Adressen till den kön uttrycks i egenskapen **ReplyTo** för det utgående meddelandet. När konsumenten svarar kopieras **meddelandet MessageId** för det hanterade meddelandet till egenskapen **CorrelationId** för svarsmeddelandet och meddelandet levereras till det mål som anges av egenskapen **ReplyTo.** Ett meddelande kan ge flera svar, beroende på programkontexten.
- **Multicast-begäran/svar:** Som en variant av föregående mönster skickar en utgivare meddelandet till ett ämne och flera prenumeranter kan använda meddelandet. Var och en av prenumeranterna kan svara på det sätt som beskrivits tidigare. Det här mönstret används i identifierings- eller uppropsscenarier och respondenten identifierar sig vanligtvis med en användaregenskap eller i nyttolasten. Om **ReplyTo** pekar på ett ämne kan en sådan uppsättning identifieringssvar distribueras till en målgrupp.
- **Multiplexering:** Den här sessionsfunktionen möjliggör multiplexering av strömmar av relaterade meddelanden via en enda kö eller prenumeration så att varje session (eller grupp) av relaterade meddelanden, som identifieras genom matchande **SessionId-värden,** dirigeras till en viss mottagare medan mottagaren håller sessionen under lås. Läs mer om detaljerna i sessioner [här](message-sessions.md).
- **Multiplexed begäran /svar:** Den här sessionen funktionen möjliggör multiplexerade svar, så att flera utgivare att dela ett svar kö. Genom att ställa in **ReplyToSessionId**kan utgivaren instruera konsumenten/konsumenterna att kopiera det värdet till egenskapen **SessionId** för svarsmeddelandet. Publiceringskön eller-ämnet behöver inte vara sessionsmedveten. När meddelandet skickas kan utgivaren sedan specifikt vänta på att en session med den angivna **SessionId** ska materialiseras i kön genom att villkorligt acceptera en sessionsmottagare. 

Routning inuti ett servicebussnamnområde kan realiseras med hjälp av auto-forward chaining och topic subscription rules. Routning över namnområden kan realiseras [med Azure LogicApps](https://azure.microsoft.com/services/logic-apps/). Som anges i föregående lista är **egenskapen Till** reserverad för framtida användning och kan så småningom tolkas av mäklaren med en särskilt aktiverad funktion. Program som vill implementera routning bör göra det baserat på användaregenskaper och inte luta sig mot egenskapen **Till.** Om du gör det nu kommer det dock inte att orsaka kompatibilitetsproblem.

## <a name="payload-serialization"></a>Serialisering av nyttolast

När nyttolasten är under överföring eller lagras inne i Service Bus är nyttolasten alltid ett ogenomskinligt, binärt block. Egenskapen [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) gör det möjligt för program att beskriva nyttolasten, med det föreslagna formatet för egenskapsvärdena som en MIME-innehållstypbeskrivning enligt IETF RFC2045. till exempel `application/json;charset=utf-8`.

Till skillnad från Java- eller .NET-standardvarianterna stöder .NET Framework-versionen av Service Bus API att skapa **BrokeredMessage-instanser** genom att skicka godtyckliga .NET-objekt till konstruktorn. 

När du använder det äldre SBMP-protokollet serialiseras dessa objekt sedan med standardbinär serialiserare eller med en serialiserare som tillhandahålls externt. När DU använder AMQP-protokollet serialiseras objektet till ett AMQP-objekt. Mottagaren kan hämta dessa objekt med metoden [GetBody\<T>()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.getbody#Microsoft_ServiceBus_Messaging_BrokeredMessage_GetBody__1) och ange den förväntade typen. Med AMQP serialiseras objekten till ett AMQP-diagram med **ArrayList** och **IDictionary<sträng,objekt>** objekt och alla AMQP-klienter kan avkoda dem. 

Även om denna dolda serialisering magi är bekvämt, bör program ta explicit kontroll över objektet serialisering och förvandla sina objekt grafer till strömmar innan inklusive dem i ett meddelande, och göra det omvända på mottagaren sidan. Detta ger driftskompatibla resultat. Det bör också noteras att medan AMQP har en kraftfull binär kodning modell, Det är knuten till AMQP messaging ekosystemet och HTTP-klienter kommer att ha problem avkodning sådana nyttolaster. 

Vi rekommenderar i allmänhet JSON och Apache Avro som nyttolastformat för strukturerade data.

.NET Standard- och Java API-varianterna accepterar bara bytematriser, vilket innebär att programmet måste hantera objekt serialiseringskontroll. 

## <a name="next-steps"></a>Nästa steg

Mer information om Service Bus-meddelanden finns i följande avsnitt:

* [Service Bus-köer, ämnen och prenumerationer](service-bus-queues-topics-subscriptions.md)
* [Komma igång med servicebussköer](service-bus-dotnet-get-started-with-queues.md)
* [Använd Service Bus ämnen och prenumerationer](service-bus-dotnet-how-to-use-topics-subscriptions.md)
