---
title: Azure Service Bus-meddelanden, nyttolaster och serialisering | Microsoft Docs
description: Översikt över Service Bus meddelandet nyttolaster
services: service-bus-messaging
documentationcenter: ''
author: axisc
manager: timlt
editor: spelluru
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/26/2018
ms.author: aschhab
ms.openlocfilehash: 3158f0255810c66605d28856133112181c2916db
ms.sourcegitcommit: 3aa0fbfdde618656d66edf7e469e543c2aa29a57
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 02/05/2019
ms.locfileid: "55733934"
---
# <a name="messages-payloads-and-serialization"></a>Meddelanden, nyttolaster och serialisering

Microsoft Azure Service Bus hanterar meddelanden. Meddelanden har en nyttolast samt metadata i form av nyckel / värde-par egenskaper, som beskriver nyttolasten och ger hantering av instruktioner till Service Bus och program. Ibland att enbart metadata är tillräcklig för att utföra den information som avsändaren vill kommunicera till mottagare och nyttolasten förblir tom.

Objektmodellen officiella Service Bus-klienter för .NET och Java återspeglar abstract Service Bus meddelandestruktur som är mappad till och från wire-protokoll som har stöd för Service Bus.
 
En Service Bus-meddelande består av ett binärt nyttolast-avsnitt som Service Bus hanterar aldrig i någon form på tjänstsidan och två uppsättningar med egenskaper. Den *mäkla egenskaper* är fördefinierade i systemet. Dessa fördefinierade egenskaper som styr antingen meddelandenivå funktionerna i Service broker eller de mappas till vanliga och standardiserad metadata-objekt. Den *användaregenskaper* är en samling nyckel / värde-par som kan definieras och ange av programmet.
 
De fördefinierade asynkrona egenskaperna visas i följande tabell. Namn som används med alla officiella klientens API: er och även i den [BrokerProperties](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) JSON-objekt för HTTP-protokollet mappningen.
 
De motsvarande namn som används på protokollnivån AMQP visas inom parentes. 

| Namn på egenskap                         | Beskrivning                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) (innehållstyp)           | Du kan också beskriver nyttolasten för meddelandet med en beskrivning som följer formatet på RFC2045, avsnitt 5; till exempel `application/json`.                                                                                                                                                                                                                                                                                             |
|  [CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid#Microsoft_Azure_ServiceBus_Message_CorrelationId) (Korrelations-id)       | Gör att ett program att ange en kontext för meddelandet för korrelation; till exempel återger den **MessageId** av ett meddelande som besvaras.                                                                                                                                                                                                                                                                  |
| [DeadLetterSource](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deadlettersource)                      | Endast in i meddelanden som har gått förlorade lettered och därefter automatiskt-vidarebefordras från obeställbara meddelanden till en annan entitet. Anger den entitet som meddelandet var dead lettered. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                                                  |
| [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount)                         | Antal leveranser som har gjorts för det här meddelandet. Antalet ökar stegvis om ett lås för meddelandet upphör att gälla eller meddelandet uttryckligen avbrutits av mottagaren. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                                                                  |
| [EnqueuedSequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedsequencenumber)                | Den här egenskapen visar sekvensnummer som först hade tilldelats till meddelandet på dess ursprungliga plats för bidrag för meddelanden som har vidarebefordras automatiskt. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                                                                                |
| [EnqueuedTimeUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedtimeutc)                       | UTC omedelbar då meddelandet har accepterat och lagras i entiteten. Det här värdet kan användas som en auktoritär och neutral ankomst tid indikator när mottagaren inte vill lita på avsändarens klockan. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                   |
|  [ExpiresAtUtc](/dotnet/api/microsoft.azure.servicebus.message.expiresatutc) (absolut-förfallotiden) | Det UTC omedelbar meddelandet är markerat för borttagning och inte längre tillgängliga för hämtning från entiteten på grund av dess förfallodatum. Förfallodatum styrs av den **TimeToLive** egenskap och den här egenskapen beräknas från EnqueuedTimeUtc + TimeToLive. Den här egenskapen är skrivskyddad.                                                                                                                                                                           |
| [ForcePersistence](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence)                      | För köer eller ämnen som har den [EnableExpress](/dotnet/api/microsoft.servicebus.messaging.queuedescription.enableexpress) flaggan, den här egenskapen kan anges för att indikera att meddelandet måste sparas till disk innan den är godkänt. Detta är det som standard gäller för alla icke-express-entiteter.                                                                                                                                                                                                         |
| [Etiketten](/dotnet/api/microsoft.azure.servicebus.message.label) (ämne)                       | Den här egenskapen gör att programmet kan anger syftet med meddelandet att mottagaren på ett standardiserat sätt liknar en e-post-ämnesrad.                                                                                                                                                                                                                                                                                  |
| [LockedUntilUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.lockeduntilutc)                        | För meddelanden som har hämtats under ett lås (peek-lock tar emot läge, inte före reglerats) den här egenskapen visar UTC omedelbar meddelandet lagras tills som låst i kö eller prenumeration. När låset upphör att gälla den [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount) ökas och meddelandet igen är tillgängliga för hämtning. Den här egenskapen är skrivskyddad.                                                                                                                         |
| [LockToken](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.locktoken)                             | Låstoken är en referens till låset av Service broker i *peek-lock* mottagningsläge. Token som kan användas för att fästa låset permanent via den [uppskjutande](message-deferral.md) API och därmed dra meddelandet från vanliga leverans tillstånd flödet. Den här egenskapen är skrivskyddad.                                                                                                                                                               |
| [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid) (meddelande-id)                | Meddelandeidentifieraren är ett programdefinierade värde som unikt identifierar meddelandet och dess nyttolast. Identifieraren är en sträng och kan återspegla ett GUID eller en identifierare som härletts från programkontexten. Om aktiverad kan den [dubblettidentifiering](duplicate-detection.md) funktionen identifierar och tar bort sekund och ytterligare överföringar av meddelanden med samma **MessageId**.                                                                |
| [partitionKey](/dotnet/api/microsoft.azure.servicebus.message.partitionkey)                          | För [partitionerade enheter](service-bus-partitioning.md), det här värdet kan tilldela relaterade meddelanden till samma interna partition, så att skicka sekvens ordning registreras korrekt. Partitionen väljs av en hash-funktion via det här värdet och går inte att välja direkt. För session-anpassade entiteter i **SessionId** egenskapen åsidosätter det här värdet.                                                                                                       |
| [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto) (svara till)                    | Det här valfria och programdefinierade värdet är ett standard sätt att uttrycka en svars-sökväg till mottagaren av meddelandet. När ett svar förväntas i en avsändare anger värdet till absolut eller relativ sökväg för kön eller ämnet det förväntar sig svar skickas till.                                                                                                                                           |
| [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid) (reply-till-grupp-id)  | Det här värdet förstärker den **ReplyTo** information och anger vilken **SessionId** ska anges för svaret när de skickas till entiteten svar.                                                                                                                                                                                                                                                                            |
| [ScheduledEnqueueTimeUtc](/dotnet/api/microsoft.azure.servicebus.message.scheduledenqueuetimeutc)               | För meddelanden som är endast tillgängliga för hämtning efter en fördröjning, definierar den här egenskapen UTC omedelbar som meddelandet är logiskt i kön, sekvenserade och därför blir tillgängliga för hämtning.                                                                                                                                                                                                                 |
| [SequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.sequencenumber)                        | Sekvensnumret är ett unikt 64-bitars heltal som tilldelas ett meddelande när den accepteras och lagras av broker och funktioner som dess SANT identifierare. För partitionerade enheter visas de översta 16 bitarna partitions-ID. Sekvensnummer monotont ökar och är utan mellanrum. De förnyas till 0 när 48-64-bitars-intervallet är slut. Den här egenskapen är skrivskyddad.                                                                |
| [Sessions-ID](/dotnet/api/microsoft.azure.servicebus.message.sessionid) (grupp-id)                  | För session-anpassade entiteter anger värdet programdefinierade session anknytningen för meddelandet. Meddelanden med samma sessions-ID är föremål för sammanfattning av låsning och aktivera exakt i ordning bearbetning och demultiplexing. För enheter som inte är medveten om sessionen, ignoreras det här värdet.                                                                                                                                     |
| [Storlek](/dotnet/api/microsoft.azure.servicebus.message.size)                                  | Visar lagrade storleken på meddelandet i broker-inloggning som en uppräkning av byte, medan den räknar mot lagringskvoten. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                                                                                                                       |
| [tillstånd](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.state)                                 | Visar status för meddelandet i loggen. Den här egenskapen gäller endast under meddelandet surfning (”peek”), för att avgöra om ett meddelande är ”aktiv” och tillgängliga för hämtning när den når upp i kön, oavsett om det är uppskjutna eller väntar på att schemaläggas. Den här egenskapen är skrivskyddad.                                                                                                                                           |
| [TimeToLive](/dotnet/api/microsoft.azure.servicebus.message.timetolive)                            | Det här värdet är den relativa efter vilken meddelandet går ut, med början från ögonblicket meddelandet har accepterat och lagras av Service broker, som anges i **EnqueueTimeUtc**. När det inte uttryckligen ändrar du värdet är angivet i **DefaultTimeToLive** för respektive kön eller ämnet. Ett meddelande på servernivå **TimeToLive** värdet får inte vara längre än entitetens **DefaultTimeToLive** inställningen. Om det inte justeras den tyst. |
| [Att](/dotnet/api/microsoft.azure.servicebus.message.to) (till)                               | Den här egenskapen är reserverad för framtida bruk i Routning scenarier och för närvarande ignoreras av den asynkrona meddelandekön själva. Program kan använda det här värdet i regel-driven automatisk chaining scenarier för att ange det avsedda logiska målet för meddelandet.                                                                                                                                                                                   |
| [ViaPartitionKey](/dotnet/api/microsoft.azure.servicebus.message.viapartitionkey)                       | Om ett meddelande skickas via en överföring kön i omfånget för en transaktion, väljer det här värdet överföring kön partitionen.                                                                                                                                                                                                                                                                                                                 |

Abstrakt meddelande-modellen kan ett meddelande att publicera till en kö via HTTP (faktiskt alltid HTTPS) och kan hämtas via AMQP. Meddelandet visas normalt i samband med respektive protokollet i båda fallen. De asynkrona egenskaperna översätts efter behov och egenskaper för användare som är mappade till den lämpligaste platsen på respektive protokollet meddelande modellen. I HTTP, användaregenskaper mappar direkt till och från HTTP-huvuden; i AMQP de mappas till och från den **egenskaper för program** kartan.

## <a name="message-routing-and-correlation"></a>Meddelanderoutning och korrelation

En delmängd av de asynkrona egenskaperna som beskrivs tidigare, specifikt [till](/dotnet/api/microsoft.azure.servicebus.message.to), [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto), [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid), [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid), [ CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid), och [SessionId](/dotnet/api/microsoft.azure.servicebus.message.sessionid), som används för att program skicka meddelanden till olika mål. Kontrollera några mönster för att illustrera detta:

- **Enkel begäran/svar**: En utgivare skickar ett meddelande till en kö och ett svar förväntas från meddelandekonsumenten. För att ta emot svaret från äger utgivaren en kö som det förväntar sig svar som ska levereras. Adressen för kön uttrycks i den **ReplyTo** för utgående meddelandet. När konsumenten svarar, kopieras den **MessageId** för hanterade meddelandet till den **CorrelationId** egenskapen svarsmeddelande och levererar meddelandet till mål som anges av **ReplyTo** egenskapen. Ett meddelande kan ge flera svar, beroende på Programkontext och.
- **Multicast-begäran/svar**: En utgivare skickar meddelandet till ett ämne som en variant av det tidigare mönstret, och flera prenumeranter blir berättigade att använda meddelandet. Var och en av prenumeranter kan svara på det sätt som beskrivs ovan. Det här mönstret används i scenarier för identifiering eller återställning-anrop och svaranden vanligtvis identifierar sig själv med en egenskap eller i nyttolasten. Om **ReplyTo** pekar på ett ämne, en sådan uppsättning identifiering svar kan distribueras till en målgrupp.
- **Multiplexering**: Den här sessionen-funktionen kan multiplexering av strömmar av relaterade meddelanden via en enda kö eller prenumeration så att varje session (eller grupp) Users, identifieras genom att matcha **SessionId** värden, dirigeras till en specifika mottagare när mottagaren innehåller under Lås-sessionen. Läs mer om information om sessioner [här](message-sessions.md).
- **Multiplex begäran/svar**: Den här sessionen-funktionen kan multiplex svar, flera utgivarna att dela en svarskö. Genom att ange **ReplyToSessionId**, utgivaren kan instruera consumer(s) att kopiera detta värde i den **SessionId** egenskap i svaret. Publicera kön eller ämnet behöver inte vara medveten om sessionen. När meddelandet har skickats utgivaren kan särskilt vänta sedan en session med den angivna **SessionId** att Materialisera för kön villkorligt accepterar en session mottagare. 

Routning i ett Service Bus-namnområde kan genomföras med hjälp av automatisk länkning och avsnittet prenumerationsregler. Routning över namnområden kan realiseras [med hjälp av Azure LogicApps](https://azure.microsoft.com/services/logic-apps/). Som anges i listan ovan den **till** egenskapen är reserverad för framtida användning och så småningom kan tolkas av den asynkrona meddelandekön med en särskilt aktiverad funktion. Program som vill implementera routning bör göra så utifrån användaregenskaper och Läs inte på den **till** egenskapen; men gör det nu inte orsakar kompatibilitetsproblem.

## <a name="payload-serialization"></a>Nyttolast-serialisering

När överförs eller lagras i Service Bus, nyttolasten är alltid ett täckande, binär-block. Den [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) egenskapen gör det möjligt för program att beskriva nyttolasten med det föreslagna formatet för de värden som en MIME-innehållstyp beskrivning enligt IETF RFC2045; exempelvis `application/json;charset=utf-8`.

Till skillnad från varianterna Java eller .NET Standard .NET Framework-version av Service Bus-API kan du skapa **BrokeredMessage** instanser genom att skicka godtyckliga .NET-objekt till konstruktören. 

När du använder det äldre SBMP-protokollet måste serialiseras objekten sedan standard binärserialiseraren eller med en serialiserare som har angetts externt. När du använder AMQP-protokollet måste serialiseras objektet till ett AMQP-objekt. Mottagaren kan hämta dessa objekt med den [GetBody<T>()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.getbody#Microsoft_ServiceBus_Messaging_BrokeredMessage_GetBody__1) metoden, ange den förväntade typen. Med AMQP och objekten serialiseras till en AMQP-diagram över **ArrayList** och **IDictionary < string, object >** objekt och alla AMQP-klient kan avkoda dem. 

Den här dolda serialisering magic är praktiskt, bör program explicit kontroll över objektserialisering och förvandla sin objektdiagram till strömmar innan du inkludera dem i ett meddelande och gör omvänd på mottagarsidan. Detta ger samverkande resultat. Det bör också noteras att medan AMQP har en kraftfull binär kodning modell, är den kopplad till meddelanden ekosystemet AMQP och HTTP-klienter har problem med att avkoda sådana nyttolaster. 

Vi rekommenderar Allmänt JSON och Apache Avro som nyttolastformat för strukturerade data.

.NET Standard och Java API-varianterna accepterar endast byte-matriser, vilket innebär att programmet ska hantera objekt serialisering kontroll. 

## <a name="next-steps"></a>Nästa steg

Om du vill veta mer om Service Bus-meddelanden, finns i följande avsnitt:

* [Service Bus-köer, ämnen och prenumerationer](service-bus-queues-topics-subscriptions.md)
* [Komma igång med Service Bus-köer](service-bus-dotnet-get-started-with-queues.md)
* [Använd Service Bus ämnen och prenumerationer](service-bus-dotnet-how-to-use-topics-subscriptions.md)
