---
title: Migrera till detaljerade rollbaserad åtkomst för klusterkonfigurationer - Azure HDInsight
description: Läs mer om de ändringar som krävs som en del av migreringen till detaljerade rollbaserad åtkomst för konfigurationer med HDInsight-kluster.
author: tylerfox
ms.author: tyfox
ms.reviewer: jasonh
ms.service: hdinsight
ms.topic: conceptual
ms.date: 06/03/2019
ms.openlocfilehash: 1ec4786291d6e2e5be6785e52cf3ab5bb5bbc690
ms.sourcegitcommit: 45e4466eac6cfd6a30da9facd8fe6afba64f6f50
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 06/07/2019
ms.locfileid: "66754532"
---
# <a name="migrate-to-granular-role-based-access-for-cluster-configurations"></a>Migrera till detaljerad rollbaserad åtkomst för klusterkonfigurationer

Vi introducerar några viktiga förändringar för att stödja mer detaljerad rollbaserad åtkomst för att få känslig information. Som en del av dessa ändras, vissa **åtgärd kan krävas** om du använder en av de [påverkas entiteter/scenarier för](#am-i-affected-by-these-changes).

## <a name="what-is-changing"></a>Vad ändras?

Tidigare hemligheter kan hämtas via HDInsight-API av kluster-användare som har den ägare, deltagare eller läsare [RBAC-roller](https://docs.microsoft.com/azure/role-based-access-control/rbac-and-directory-admin-roles), som de var tillgängliga för alla som har den `*/read` behörighet krävdes.
Framöver kommer åtkomst till dessa hemligheter kräver den `Microsoft.HDInsight/clusters/configurations/*` behörighet, vilket innebär att de inte längre kan nås av användare med rollen läsare. Hemligheter är definierade som värden som kan användas för att få mer utökad åtkomst än en användarroll ska tillåta. Dessa inkluderar värden som HTTP-gateway på klusternivå, lagringskontonycklar och autentiseringsuppgifter på databasen.

Lanserar vi även en ny [Hdinsight-kluster operatorn](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#hdinsight-cluster-operator) roll som kommer att kunna hämta hemligheter utan beviljas administratörsbehörighet för deltagare eller ägare. Sammanfattningsvis:

| Roll                                  | Tidigare                                                                                       | Vi rekommenderar att       |
|---------------------------------------|--------------------------------------------------------------------------------------------------|-----------|
| Läsare                                | -Läs-åtkomst, inklusive hemligheter                                                                   | -Läsbehörighet, **exklusive** hemligheter |           |   |   |
| HDInsight-kluster-Operator<br>(Ny roll) | Gäller inte                                                                                              | Läs-/ skrivåtkomst, inklusive hemligheter         |   |   |
| Deltagare                           | Läs-/ skrivåtkomst, inklusive hemligheter<br>– Skapa och hantera alla typer av Azure-resurser.     | Ingen förändring |
| Ägare                                 | Läs-/ skrivåtkomst inklusive hemligheter<br>– Fullständig åtkomst till alla resurser<br>-Delegera åtkomst till andra | Ingen förändring |

Information om hur du lägger till HDInsight-kluster operatorn rolltilldelning till en användare att ge dem läs/skrivbehörighet till klustret hemligheter, finns i den under avsnitt, [Lägg till rolltilldelning Operator för HDInsight-kluster till en användare](#add-the-hdinsight-cluster-operator-role-assignment-to-a-user).

## <a name="am-i-affected-by-these-changes"></a>Påverkas jag av dessa ändringar?

Följande entiteter och scenarier som påverkas:

- [API](#api): Användare som använder den `/configurations` eller `/configurations/{configurationName}` slutpunkter.
- [Azure HDInsight Tools för Visual Studio Code](#azure-hdinsight-tools-for-visual-studio-code) version 1.1.1 eller lägre.
- [Azure Toolkit för IntelliJ](#azure-toolkit-for-intellij) version 3.20.0 eller lägre.
- [Azure Data Lake och Stream Analytics Tools för Visual Studio](#azure-data-lake-and-stream-analytics-tools-for-visual-studio) under 2.3.9000.1.
- [Azure Toolkit för Eclipse](#azure-toolkit-for-eclipse) version 3.15.0 eller lägre.
- [SDK för .NET](#sdk-for-net)
    - [versioner 1.x och 2.x](#versions-1x-and-2x): Användare som använder den `GetClusterConfigurations`, `GetConnectivitySettings`, `ConfigureHttpSettings`, `EnableHttp` eller `DisableHttp` metoderna i klassen ConfigurationsOperationsExtensions.
    - [versioner 3.x och upp](#versions-3x-and-up): Användare som använder den `Get`, `Update`, `EnableHttp`, eller `DisableHttp` metoder från den `ConfigurationsOperationsExtensions` klass.
- [SDK för Python](#sdk-for-python): Användare som använder den `get` eller `update` metoder från den `ConfigurationsOperations` klass.
- [SDK för Java](#sdk-for-java): Användare som använder den `update` eller `get` metoder från den `ConfigurationsInner` klass.
- [SDK för Go](#sdk-for-go): Användare som använder den `Get` eller `Update` metoder från den `ConfigurationsClient` Struct-datatypen.
- [Az.HDInsight PowerShell](#azhdinsight-powershell) nedan version 2.0.0.
Läs avsnitten nedan (eller använd länkarna ovan) om du vill se migreringsanvisningarna för ditt scenario.

### <a name="api"></a>API

Följande API: er kan ändras eller inaktuell:

- [**GET-/configurations/ {configurationName}** ](https://docs.microsoft.com/rest/api/hdinsight/hdinsight-cluster#get-configuration) (känslig information tas bort)
    - Tidigare används för att hämta enskilda konfigurationerna (inklusive hemligheter).
    - Den här API-anrop returnerar nu enskilda konfigurationerna med hemligheter utelämnas. Hämta alla inställningar, till exempel hemligheter, med nya INLÄGG /configurations anropet. Hämta bara gateway-inställningar med det nya INLÄGG /getGatewaySettings anropet.
- [**GET-/configurations** ](https://docs.microsoft.com/rest/api/hdinsight/hdinsight-cluster#get-configuration) (inaktuell)
    - Användes för att hämta alla konfigurationer (inklusive hemligheter)
    - Den här API-anrop kommer inte längre att stödjas. Hämta alla konfigurationer framöver med nya INLÄGG /configurations anropet. Hämta konfigurationer med känsliga parametrar utelämnas med GET /configurations/ {configurationName}-anrop.
- [**POST /configurations/ {configurationName}** ](https://docs.microsoft.com/rest/api/hdinsight/hdinsight-cluster#update-gateway-settings) (inaktuell)
    - Tidigare används för att uppdatera gateway-autentiseringsuppgifter.
    - Den här API-anrop kommer föråldrad och inte längre stöds. Använd den nya INLÄGG /updateGatewaySettings i stället.

Följande ersättningen API: er har lagts till:</span>

- [**POST /configurations**](https://docs.microsoft.com/rest/api/hdinsight/hdinsight-cluster#list-configurations)
    - Du kan använda detta API för att hämta alla inställningar, till exempel hemligheter.
- [**POST /getGatewaySettings**](https://docs.microsoft.com/rest/api/hdinsight/hdinsight-cluster#get-gateway-settings)
    - Du kan använda detta API för att hämta gateway-inställningar.
- [**POST /updateGatewaySettings**](https://docs.microsoft.com/rest/api/hdinsight/hdinsight-cluster#update-gateway-settings)
    - Använd detta API om du vill uppdatera gateway-inställningar (användarnamn och/eller lösenord).

### <a name="azure-hdinsight-tools-for-visual-studio-code"></a>Azure HDInsight Tools för Visual Studio Code

Om du använder version 1.1.1 eller nedan uppdaterar till den [senaste versionen av Azure HDInsight Tools för Visual Studio Code](https://marketplace.visualstudio.com/items?itemName=mshdinsight.azure-hdinsight&ssr=false) att undvika avbrott i verksamheten.

### <a name="azure-toolkit-for-intellij"></a>Azure Toolkit för IntelliJ

Om du använder version 3.20.0 eller nedan uppdaterar till den [senaste versionen av Azure Toolkit för IntelliJ plugin-programmet](https://plugins.jetbrains.com/plugin/8053-azure-toolkit-for-intellij) att undvika avbrott i verksamheten.

### <a name="azure-data-lake-and-stream-analytics-tools-for-visual-studio"></a>Azure Data Lake och Stream Analytics Tools för Visual Studio

Uppdatera till version 2.3.9000.1 eller senare av [Azure Data Lake och Stream Analytics Tools för Visual Studio](https://marketplace.visualstudio.com/items?itemName=ADLTools.AzureDataLakeandStreamAnalyticsTools&ssr=false#overview) att undvika avbrott i verksamheten.  Hjälp med uppdatering finns i dokumentationen för [uppdatering Data Lake Tools för Visual Studio](https://docs.microsoft.com/azure/hdinsight/hadoop/apache-hadoop-visual-studio-tools-get-started#update-data-lake-tools-for-visual-studio).

### <a name="azure-toolkit-for-eclipse"></a>Azure Toolkit för Eclipse

Om du använder version 3.15.0 eller nedan uppdaterar till den [senaste versionen av Azure Toolkit för Eclipse](https://marketplace.eclipse.org/content/azure-toolkit-eclipse) att undvika avbrott i verksamheten.

### <a name="sdk-for-net"></a>SDK för .NET

#### <a name="versions-1x-and-2x"></a>Versioner 1.x och 2.x

Uppdatera till [version 2.1.0](https://www.nuget.org/packages/Microsoft.Azure.Management.HDInsight/2.1.0) av HDInsight SDK för .NET. Minimal kodändringar kan krävas om du använder en metod som påverkas av ändringarna:

- `ClusterOperationsExtensions.GetClusterConfigurations` kommer **inte längre returneras känsliga parametrar** som lagringsnycklar (core-plats) eller HTTP-autentiseringsuppgifter (gateway).
    - Använd för att hämta alla inställningar, till exempel känsliga parametrar `ClusterOperationsExtensions.ListConfigurations` framöver.  Observera att användare med rollen ”läsare” inte kommer att kunna använda den här metoden. Det möjliggör detaljerad kontroll över vilka användare kan komma åt känslig information för ett kluster.
    - Använd för att hämta bara HTTP-gateway-autentiseringsuppgifter, `ClusterOperationsExtensions.GetGatewaySettings`.

- `ClusterOperationsExtensions.GetConnectivitySettings` Nu är föråldrade och har ersatts av `ClusterOperationsExtensions.GetGatewaySettings`.

- `ClusterOperationsExtensions.ConfigureHttpSettings` Nu är föråldrade och har ersatts av `ClusterOperationsExtensions.UpdateGatewaySettings`.

- `ConfigurationsOperationsExtensions.EnableHttp` och `DisableHttp` nu är föråldrade. HTTP är nu alltid aktiverad, så dessa metoder är inte längre behövs.

#### <a name="versions-3x-and-up"></a>Versioner 3.x och senare

Uppdatera till [version 5.0.0](https://www.nuget.org/packages/Microsoft.Azure.Management.HDInsight/5.0.0) eller senare av HDInsight SDK för .NET. Minimal kodändringar kan krävas om du använder en metod som påverkas av ändringarna:

- [`ConfigurationOperationsExtensions.Get`](https://docs.microsoft.com/dotnet/api/microsoft.azure.management.hdinsight.configurationsoperationsextensions.get?view=azure-dotnet) kommer **inte längre returneras känsliga parametrar** som lagringsnycklar (core-plats) eller HTTP-autentiseringsuppgifter (gateway).
    - Använd för att hämta alla inställningar, till exempel känsliga parametrar [ `ConfigurationOperationsExtensions.List` ](https://docs.microsoft.com/dotnet/api/microsoft.azure.management.hdinsight.configurationsoperationsextensions.list?view=azure-dotnet) framöver.  Observera att användare med rollen ”läsare” inte kommer att kunna använda den här metoden. Det möjliggör detaljerad kontroll över vilka användare kan komma åt känslig information för ett kluster. 
    - Använd för att hämta bara HTTP-gateway-autentiseringsuppgifter, [ `ClusterOperationsExtensions.GetGatewaySettings` ](https://docs.microsoft.com/dotnet/api/microsoft.azure.management.hdinsight.clustersoperationsextensions.getgatewaysettings?view=azure-dotnet). 
- [`ConfigurationsOperationsExtensions.Update`](https://docs.microsoft.com/dotnet/api/microsoft.azure.management.hdinsight.configurationsoperationsextensions.update?view=azure-dotnet) Nu är föråldrade och har ersatts av [ `ClusterOperationsExtensions.UpdateGatewaySettings` ](https://docs.microsoft.com/dotnet/api/microsoft.azure.management.hdinsight.clustersoperationsextensions.updategatewaysettings?view=azure-dotnet). 
- [`ConfigurationsOperationsExtensions.EnableHttp`](https://docs.microsoft.com/dotnet/api/microsoft.azure.management.hdinsight.configurationsoperationsextensions.enablehttp?view=azure-dotnet) och [ `DisableHttp` ](https://docs.microsoft.com/dotnet/api/microsoft.azure.management.hdinsight.configurationsoperationsextensions.disablehttp?view=azure-dotnet) nu är föråldrade. HTTP är nu alltid aktiverad, så dessa metoder är inte längre behövs.

### <a name="sdk-for-python"></a>SDK för Python

Uppdatera till [version 1.0.0](https://pypi.org/project/azure-mgmt-hdinsight/1.0.0/) eller senare av HDInsight SDK för Python. Minimal kodändringar kan krävas om du använder en metod som påverkas av ändringarna:

- [`ConfigurationsOperations.get`](https://docs.microsoft.com/python/api/azure-mgmt-hdinsight/azure.mgmt.hdinsight.operations.configurations_operations.configurationsoperations?view=azure-python#get-resource-group-name--cluster-name--configuration-name--custom-headers-none--raw-false----operation-config-) kommer **inte längre returneras känsliga parametrar** som lagringsnycklar (core-plats) eller HTTP-autentiseringsuppgifter (gateway).
    - Använd för att hämta alla inställningar, till exempel känsliga parametrar [ `ConfigurationsOperations.list` ](https://docs.microsoft.com/python/api/azure-mgmt-hdinsight/azure.mgmt.hdinsight.operations.configurations_operations.configurationsoperations?view=azure-python#list-resource-group-name--cluster-name--custom-headers-none--raw-false----operation-config-) framöver.  Observera att användare med rollen ”läsare” inte kommer att kunna använda den här metoden. Det möjliggör detaljerad kontroll över vilka användare kan komma åt känslig information för ett kluster. 
    - Använd för att hämta bara HTTP-gateway-autentiseringsuppgifter, [ `ConfigurationsOperations.get_gateway_settings` ](https://docs.microsoft.com/python/api/azure-mgmt-hdinsight/azure.mgmt.hdinsight.operations.clusters_operations.clustersoperations?view=azure-python#get-gateway-settings-resource-group-name--cluster-name--custom-headers-none--raw-false----operation-config-).
- [`ConfigurationsOperations.update`](https://docs.microsoft.com/python/api/azure-mgmt-hdinsight/azure.mgmt.hdinsight.operations.clusters_operations.clustersoperations?view=azure-python#update-resource-group-name--cluster-name--tags-none--custom-headers-none--raw-false----operation-config-) Nu är föråldrade och har ersatts av [ `ClusterOperations.update_gateway_settings` ](https://docs.microsoft.com/python/api/azure-mgmt-hdinsight/azure.mgmt.hdinsight.operations.clusters_operations.clustersoperations?view=azure-python#update-gateway-settings-resource-group-name--cluster-name--parameters--custom-headers-none--raw-false--polling-true----operation-config-).

### <a name="sdk-for-java"></a>SDK för Java

Uppdatera till [version 1.0.0](https://search.maven.org/artifact/com.microsoft.azure.hdinsight.v2018_06_01_preview/azure-mgmt-hdinsight/) eller senare av HDInsight SDK för Java. Minimal kodändringar kan krävas om du använder en metod som påverkas av ändringarna:

- [`ConfigurationsInner.get`](https://docs.microsoft.com/java/api/com.microsoft.azure.management.hdinsight.v2018__06__01__preview.implementation._configurations_inner.get) kommer **inte längre returneras känsliga parametrar** som lagringsnycklar (core-plats) eller HTTP-autentiseringsuppgifter (gateway).
    - Använd för att hämta alla inställningar, till exempel känsliga parametrar [ `ConfigurationsInner.list` ](https://docs.microsoft.com/java/api/com.microsoft.azure.management.hdinsight.v2018_06_01_preview.implementation.configurationsinner.list?view=azure-java-stable) framöver.  Observera att användare med rollen ”läsare” inte kommer att kunna använda den här metoden. Det möjliggör detaljerad kontroll över vilka användare kan komma åt känslig information för ett kluster. 
    - Använd för att hämta bara HTTP-gateway-autentiseringsuppgifter, [ `ClustersInner.getGatewaySettings` ](https://docs.microsoft.com/java/api/com.microsoft.azure.management.hdinsight.v2018_06_01_preview.implementation.clustersinner.getgatewaysettings?view=azure-java-stable).
- [`ConfigurationsInner.update`](https://docs.microsoft.com/java/api/com.microsoft.azure.management.hdinsight.v2018__06__01__preview.implementation._configurations_inner.update) Nu är föråldrade och har ersatts av [ `ClustersInner.updateGatewaySettings` ](https://docs.microsoft.com/java/api/com.microsoft.azure.management.hdinsight.v2018_06_01_preview.implementation.clustersinner.updategatewaysettings?view=azure-java-stable).

### <a name="sdk-for-go"></a>SDK för Go

Uppdatera till [version 27.1.0](https://github.com/Azure/azure-sdk-for-go/tree/master/services/preview/hdinsight/mgmt/2018-06-01-preview/hdinsight) eller senare av HDInsight SDK för Go. Minimal kodändringar kan krävas om du använder en metod som påverkas av ändringarna:

- [`ConfigurationsClient.get`](https://godoc.org/github.com/Azure/azure-sdk-for-go/services/preview/hdinsight/mgmt/2018-06-01-preview/hdinsight#ConfigurationsClient.Get) kommer **inte längre returneras känsliga parametrar** som lagringsnycklar (core-plats) eller HTTP-autentiseringsuppgifter (gateway).
    - Använd för att hämta alla inställningar, till exempel känsliga parametrar [ `ConfigurationsClient.list` ](https://godoc.org/github.com/Azure/azure-sdk-for-go/services/preview/hdinsight/mgmt/2018-06-01-preview/hdinsight#ConfigurationsClient.List) framöver.  Observera att användare med rollen ”läsare” inte kommer att kunna använda den här metoden. Det möjliggör detaljerad kontroll över vilka användare kan komma åt känslig information för ett kluster. 
    - Använd för att hämta bara HTTP-gateway-autentiseringsuppgifter, [ `ClustersClient.get_gateway_settings` ](https://godoc.org/github.com/Azure/azure-sdk-for-go/services/preview/hdinsight/mgmt/2018-06-01-preview/hdinsight#ClustersClient.GetGatewaySettings).
- [`ConfigurationsClient.update`](https://godoc.org/github.com/Azure/azure-sdk-for-go/services/preview/hdinsight/mgmt/2018-06-01-preview/hdinsight#ConfigurationsClient.Update) Nu är föråldrade och har ersatts av [ `ClustersClient.update_gateway_settings` ](https://godoc.org/github.com/Azure/azure-sdk-for-go/services/preview/hdinsight/mgmt/2018-06-01-preview/hdinsight#ClustersClient.UpdateGatewaySettings).

### <a name="azhdinsight-powershell"></a>Az.HDInsight PowerShell
Uppdatera till [Az PowerShell version 2.0.0](https://www.powershellgallery.com/packages/Az) eller senare för att undvika avbrott i verksamheten.  Minimal kodändringar kan krävas om du använder en metod som påverkas av ändringarna.
- `Grant-AzHDInsightHttpServicesAccess` Nu är föråldrade och har ersatts av den nya `Set-AzHDInsightGatewayCredential` cmdlet.
- `Get-AzHDInsightJobOutput` har uppdaterats för att stödja detaljerade rollbaserad åtkomst till lagringskontots åtkomstnyckel.
    - Användare med HDInsight-kluster-Operator, deltagare eller ägare roller påverkas inte.
    - Användare med endast rollen läsare måste ange den `DefaultStorageAccountKey` parametern uttryckligen.
- `Revoke-AzHDInsightHttpServicesAccess` är nu föråldrad. HTTP är nu alltid aktiverad, så att denna cmdlet behövs inte längre.
 Se den [az. Migreringsguide för HDInsight](https://github.com/Azure/azure-powershell/blob/master/documentation/migration-guides/Az.2.0.0-migration-guide.md#azhdinsight) för mer information.

## <a name="add-the-hdinsight-cluster-operator-role-assignment-to-a-user"></a>Lägg till rolltilldelning Operator för HDInsight-kluster till en användare

En användare med den [deltagare](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#contributor) eller [ägare](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#owner) rollen kan tilldela den [Hdinsight-kluster operatorn](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#hdinsight-cluster-operator) roll till användare som du vill ha läs-/ skrivåtkomst till känsliga HDInsight-kluster-konfigurationsvärden (till exempel autentiseringsuppgifter för kluster-gateway och lagringskontonycklar).

### <a name="using-the-azure-cli"></a>Använda Azure CLI

Det enklaste sättet att lägga till den här rolltilldelningen är med hjälp av den `az role assignemnt create` i Azure CLI.

> [!NOTE]
> Det här kommandot måste köras av en användare med rollerna deltagare eller ägare som endast de kan bevilja dessa behörigheter. Den `--assignee` är e-postadressen för användaren som du vill tilldela rollen operatör för HDInsight-kluster.

#### <a name="grant-role-at-the-resource-cluster-level"></a>Ge rollen på resursnivån (kluster)

```azurecli-interactive
az role assignment create --role "HDInsight Cluster Operator" --assignee <user@domain.com> --scope /subscriptions/<SubscriptionId>/resourceGroups/<ResourceGroupName>/providers/Microsoft.HDInsight/clusters/<ClusterName>
```

#### <a name="grant-role-at-the-resource-group-level"></a>Ge rollen på resursgruppsnivå

```azurecli-interactive
az role assignment create --role "HDInsight Cluster Operator" --assignee user@domain.com -g <ResourceGroupName>
```

#### <a name="grant-role-at-the-subscription-level"></a>Ge rollen på prenumerationsnivån

```azurecli-interactive
az role assignment create --role "HDInsight Cluster Operator" --assignee user@domain.com
```

### <a name="using-the-azure-portal"></a>Använda Azure Portal

Du kan också använda Azure-portalen för att lägga till HDInsight-kluster operatorn rolltilldelning till en användare. Finns i dokumentationen för [hantera åtkomst till Azure-resurser med RBAC och Azure portal – Lägg till en rolltilldelning](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal#add-a-role-assignment).
