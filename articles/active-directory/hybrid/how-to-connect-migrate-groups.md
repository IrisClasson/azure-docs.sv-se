---
title: 'Azure AD Connect: Migrera grupper från en skog till en annan | Microsoft-dokument'
description: I den här artikeln beskrivs de steg som krävs för att migrera grupper från en skog till en annan för Azure AD Connect.
services: active-directory
author: billmath
manager: daveba
ms.service: active-directory
ms.topic: reference
ms.workload: identity
ms.date: 04/02/2020
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 602c60de392afbff18bc141605a936636e48dbfe
ms.sourcegitcommit: ffc6e4f37233a82fcb14deca0c47f67a7d79ce5c
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 04/21/2020
ms.locfileid: "81729692"
---
# <a name="migrate-groups-from-one-forest-to-another-for-azure-ad-connect"></a>Migrera grupper från en skog till en annan för Azure AD Connect

I den här artikeln beskrivs de steg som krävs för att migrera grupper från en skog till en annan så att de migrerade gruppobjekten matchar de befintliga objekten i molnet.

## <a name="prerequisites"></a>Krav

- Azure AD Connect version 1.5.18.0 eller senare
- Attributet Source Anchor är`mS-DS-ConsistencyGuid`

Från och med version 1.5.18.0 har Azure `mS-DS-ConsistencyGuid` AD Connect börjat stödja användningen av för grupper. Om `mS-DS-ConsistencyGuid` väljs som källankaretattribut och värdet fylls i i `mS-DS-ConsistencyGuid` AD, använder Azure AD Connect värdet som oföränderligId. Annars faller det tillbaka `objectGUID`till att använda . Observera dock att Azure AD **Connect INTE** skriver `mS-DS-ConsistencyGuid` tillbaka värdet till attributet i AD.

Under ett cross-forest move scenario där ett gruppobjekt flyttar från en skog (säg F1) till en `mS-DS-ConsistencyGuid` annan skog (säg F2), måste vi kopiera över antingen värdet (Om NU) eller `objectGUID` värde från objektet i skog F1 till `mS-DS-ConsistencyGuid` attributet för objektet i F2. 

Använd följande skript som riktlinje för att se hur du kan migrera en enskild grupp från skog F1 till skog F2. Du får gärna använda detta som en riktlinje för att göra migreringen för flera grupper.

Först får vi `objectGUID` `mS-DS-ConsistencyGuid` och av gruppobjekt i skog F1. Dessa attribut exporteras till en CSV-fil.
```
<#
DESCRIPTION
============
This script will take DN of a group as input.
It then copies the objectGUID and mS-DS-ConsistencyGuid values along with other attributes of the given group to a CSV file.

This CSV file can then be used as input to Export-Group script
#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $outputCsv
)

$defaultProperties = @('samAccountName', 'distinguishedName', 'objectGUID', 'mS-DS-ConsistencyGuid')
$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -Properties $defaultProperties -ErrorAction Stop
$results = @()
if ($group -eq $null)
{
       Write-Error "Group not found"
}
else
{
       $objectGUIDValue = [GUID]$group.'objectGUID'
       $mSDSConsistencyGuidValue = "N/A"
       if ($group.'mS-DS-ConsistencyGuid' -ne $null)
       {
              $mSDSConsistencyGuidValue = [GUID]$group.'mS-DS-ConsistencyGuid'
       }
       $adgroup = New-Object -TypeName PSObject
       $adgroup | Add-Member -MemberType NoteProperty -Name samAccountName -Value $($group.'samAccountName')
       $adgroup | Add-Member -MemberType NoteProperty -Name distinguishedName -Value $($group.'distinguishedName')
       $adgroup | Add-Member -MemberType NoteProperty -Name objectGUID -Value $($objectGUIDValue)
       $adgroup | Add-Member -MemberType NoteProperty -Name mS-DS-ConsistencyGuid -Value $($mSDSConsistencyGuidValue)
       $results += $adgroup
}

Write-Host "Exporting group to output file"
$results | Export-Csv "$outputCsv" -NoTypeInformation

```

Därefter använder vi den genererade utdata `mS-DS-ConsistencyGuid` CSV-filen för att stämpla attributet på målobjektet i skog F2.


```
<#
DESCRIPTION
============
This script will take DN of a group as input and the CSV file that was generated by Import-Group script
It copies either the objectGUID or mS-DS-ConsistencyGuid value from CSV file to the given object.

#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $inputCsv
)

$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -ErrorAction Stop
if ($group -eq $null)
{
       Write-Error "Group not found"
}

$csvFile = Import-Csv -Path $inputCsv -ErrorAction Stop
$msDSConsistencyGuid = $csvFile.'mS-DS-ConsistencyGuid'
$objectGuid = [GUID] $csvFile.'objectGUID'
$targetGuid = $msDSConsistencyGuid

if ($msDSConsistencyGuid -eq "N/A")
{
       $targetGuid = $objectGuid
}

Set-ADGroup -Identity $dn -Replace @{'mS-DS-ConsistencyGuid'=$targetGuid} -ErrorAction Stop

```

## <a name="next-steps"></a>Nästa steg
Läs mer om hur du [integrerar dina lokala identiteter med Azure Active Directory](whatis-hybrid-identity.md).
